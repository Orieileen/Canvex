# =========================
# Django 基础配置
# =========================

# Django 安全密钥（生产环境请替换为随机长字符串）
DJANGO_SECRET_KEY=change-me-please

# 是否开启 Django DEBUG（本地开发建议 true，生产建议 false）
DJANGO_DEBUG=true

# 后端映射到宿主机的端口（容器内始终为 8000）
BACKEND_PORT=28000

# 前端映射到宿主机的端口（容器内始终为 5173）
FRONTEND_PORT=5173

# Django 允许访问的 Host，逗号分隔
DJANGO_ALLOWED_HOSTS=localhost,127.0.0.1,backend

# Django 时区（例如 Asia/Shanghai 或 UTC）
DJANGO_TIME_ZONE=Asia/Shanghai

# SQLite 数据库文件路径（容器内路径）
SQLITE_PATH=/app/db.sqlite3

# =========================
# CORS / 前后端联调
# =========================

# 是否允许所有来源跨域（本地调试建议 true）
CORS_ALLOW_ALL_ORIGINS=true

# 当 CORS_ALLOW_ALL_ORIGINS=false 时生效，白名单来源（逗号分隔）
CORS_ALLOWED_ORIGINS=http://localhost:5173,http://127.0.0.1:5173

# =========================
# Redis / Celery
# =========================

# Redis 连接地址（用于 Celery broker/result 与 memory 状态）
REDIS_URL=redis://redis:6379/0

# Celery Broker 地址（不填则回退 REDIS_URL）
CELERY_BROKER_URL=redis://redis:6379/0

# Celery Result Backend 地址（不填则回退 REDIS_URL）
CELERY_RESULT_BACKEND=redis://redis:6379/0

# 是否让 Celery 同步执行任务（调试时可设 true）
CELERY_TASK_ALWAYS_EAGER=false

# =========================
# URL / 媒体资源
# =========================

# 后端对外基础 URL（用于拼接绝对媒体地址）
PUBLIC_BASE_URL=http://localhost:28000

# 媒体文件公网基础地址（可与 PUBLIC_BASE_URL 相同）
PUBLIC_MEDIA_BASE=http://localhost:28000

# 后端容器内部访问媒体的基础地址（worker 拉取 localhost 媒体时会回退到这个地址）
INTERNAL_MEDIA_BASE=http://backend:8000

# =========================
# OpenAI Provider（仅聊天）
# =========================

# OpenAI API Key
OPENAI_API_KEY=

# OpenAI 兼容网关 Base URL（直连官方可留空）
OPENAI_BASE_URL=

# OpenAI 请求超时时间（秒）
OPENAI_TIMEOUT=180

# 聊天模型名（用于 SSE 对话）
EXCALIDRAW_CHAT_MODEL=gpt-4o-mini

# 聊天温度参数（越高越发散）
EXCALIDRAW_CHAT_TEMPERATURE=0.4

# 聊天最大输出 token（留空表示使用服务端默认）
EXCALIDRAW_CHAT_MAX_TOKENS=

# =========================
# Media OpenAI Provider（生图 / 编辑图 / 视频）
# =========================

# 媒体专用 OpenAI 兼容网关地址
MEDIA_OPENAI_BASE_URL=

# 媒体专用 OpenAI 兼容 API Key
MEDIA_OPENAI_API_KEY=

# 媒体专用请求超时（秒，默认回退 OPENAI_TIMEOUT；视频场景建议>=600）
MEDIA_OPENAI_TIMEOUT=600

# 媒体生图模型名（imagetool）
MEDIA_OPENAI_IMAGE_MODEL=gemini-2.5-flash-image

# 媒体图片编辑模型名（image-edit，需支持 edits）
MEDIA_OPENAI_IMAGE_EDIT_MODEL=gemini-2.5-flash-image

# 媒体视频脚本分析模型名（可与聊天模型兼容）
MEDIA_OPENAI_SCRIPT_MODEL=gpt-5-mini

# 图片编辑失败时是否允许回退到“纯文生图”（会忽略原图；默认 false）
EXCALIDRAW_IMAGE_EDIT_ALLOW_TEXT_FALLBACK=false

# 媒体视频模型名
MEDIA_OPENAI_VIDEO_MODEL=sora-2-pro

# 媒体视频是否要求 input_reference（当前多数 sora 兼容网关建议 true）
MEDIA_OPENAI_VIDEO_REQUIRE_REFERENCE=true

# 媒体视频允许秒数（逗号分隔；请求会自动映射到最近可用值）
MEDIA_OPENAI_VIDEO_SECONDS_ALLOWED=4,8,10,12,15,25

# 媒体视频默认秒数（当用户输入无效时使用）
MEDIA_OPENAI_VIDEO_SECONDS_DEFAULT=10

# 是否启用 /videos/generations 旧回退（多数 OpenAI 兼容网关不支持，建议 false）
MEDIA_OPENAI_VIDEO_ENABLE_LEGACY_FALLBACK=false

# 媒体视频轮询总超时（秒，默认 1800=30 分钟；会自动换算成最少轮询次数）
MEDIA_OPENAI_VIDEO_TIMEOUT_SECONDS=1800

# 媒体视频轮询最大次数（作为下限保护；默认 360 次 * 5 秒 = 30 分钟）
MEDIA_OPENAI_VIDEO_POLL_MAX_ATTEMPTS=360

# 媒体视频轮询间隔（秒）
MEDIA_OPENAI_VIDEO_POLL_INTERVAL=5

# 视频尺寸默认值（按横竖屏映射）
MEDIA_OPENAI_VIDEO_SIZE_LANDSCAPE=1280x720
MEDIA_OPENAI_VIDEO_SIZE_PORTRAIT=720x1280

# =========================
# Frontend（Vite）
# =========================

# 前端请求后端 API 的地址
VITE_API_URL=http://localhost:28000

# Excalidraw 资源根路径（字体/静态资源，必须指向自托管目录）
VITE_EXCALIDRAW_ASSET_PATH=/excalidraw-assets/

# 前端视频任务轮询最大次数（默认 600 次）
VITE_VIDEO_POLL_MAX_ATTEMPTS=600

# 前端视频任务轮询间隔（毫秒，默认 3000）
VITE_VIDEO_POLL_INTERVAL_MS=3000

# 画布自动保存普通防抖（毫秒，越小保存越频繁，默认 600）
VITE_SCENE_SAVE_DEBOUNCE_MS=600

# 画布自动保存紧急防抖（毫秒，用于高优先级触发，默认 180）
VITE_SCENE_SAVE_URGENT_MS=180

# 画布变更后最久未落库时间（毫秒，超过后会强制 flush，默认 1600）
VITE_SCENE_SAVE_FORCE_FLUSH_MS=1600

# 自动保存巡检周期（毫秒，默认 700）
VITE_SCENE_SAVE_WATCH_INTERVAL_MS=700

# 本地工作区标识（用于本地缓存 key 隔离）
VITE_WORKSPACE_KEY=public

# 后端工作区标识（无账号语义下用于 memory key）
WORKSPACE_ID=public
